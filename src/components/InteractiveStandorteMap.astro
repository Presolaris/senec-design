---
// Interaktive Google Maps-Karte mit Standort-Markern und InfoWindows f√ºr Astro
// Verwendet Manus Google Maps Proxy f√ºr automatische Authentifizierung

// Standort-Daten mit Koordinaten, Adressen und √ñffnungszeiten
const locations = [
  {
    name: "Leipzig",
    lat: 51.3397,
    lng: 12.3731,
    address: "An der Hebem√§rchte 1, 04316 Leipzig",
    phone: "+49 341 12345678",
    hours: "Mo-Fr: 08:00-18:00 Uhr<br>Sa: 09:00-14:00 Uhr"
  },
  {
    name: "Dresden",
    lat: 51.0504,
    lng: 13.7373,
    address: "Dresdner Stra√üe 1, 01067 Dresden",
    phone: "+49 351 12345678",
    hours: "Mo-Fr: 08:00-18:00 Uhr<br>Sa: 09:00-14:00 Uhr"
  },
  {
    name: "Magdeburg",
    lat: 52.1205,
    lng: 11.6276,
    address: "Magdeburger Stra√üe 1, 39104 Magdeburg",
    phone: "+49 391 12345678",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Halle",
    lat: 51.4825,
    lng: 11.9705,
    address: "Hallische Stra√üe 1, 06108 Halle",
    phone: "+49 345 12345678",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Erfurt",
    lat: 50.9787,
    lng: 11.0328,
    address: "Erfurter Stra√üe 1, 99084 Erfurt",
    phone: "+49 361 12345678",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Gera",
    lat: 50.8797,
    lng: 12.0833,
    address: "Geraer Stra√üe 1, 07545 Gera",
    phone: "+49 365 12345678",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Delitzsch",
    lat: 51.5253,
    lng: 12.3375,
    address: "Delitzscher Stra√üe 1, 04509 Delitzsch",
    phone: "+49 34202 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Naumburg",
    lat: 51.1508,
    lng: 11.8103,
    address: "Naumburger Stra√üe 1, 06618 Naumburg",
    phone: "+49 3445 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Bitterfeld",
    lat: 51.6236,
    lng: 12.3297,
    address: "Bitterfelder Stra√üe 1, 06749 Bitterfeld-Wolfen",
    phone: "+49 3493 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Grimma",
    lat: 51.2356,
    lng: 12.7233,
    address: "Grimmaer Stra√üe 1, 04668 Grimma",
    phone: "+49 3437 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "D√∂beln",
    lat: 51.1219,
    lng: 13.1122,
    address: "D√∂belner Stra√üe 1, 04720 D√∂beln",
    phone: "+49 3431 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Riesa",
    lat: 51.3072,
    lng: 13.2919,
    address: "Riesaer Stra√üe 1, 01587 Riesa",
    phone: "+49 3525 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Ludwigsfelde",
    lat: 52.2972,
    lng: 13.2597,
    address: "Ludwigsfelder Stra√üe 1, 14974 Ludwigsfelde",
    phone: "+49 3378 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Borna",
    lat: 51.1236,
    lng: 12.4975,
    address: "Bornaer Stra√üe 1, 04552 Borna",
    phone: "+49 3433 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Wurzen",
    lat: 51.3678,
    lng: 12.7408,
    address: "Wurzener Stra√üe 1, 04808 Wurzen",
    phone: "+49 3425 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Wei√üenfels",
    lat: 51.1997,
    lng: 11.9686,
    address: "Wei√üenfelser Stra√üe 1, 06667 Wei√üenfels",
    phone: "+49 3443 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  },
  {
    name: "Zeitz",
    lat: 51.0497,
    lng: 12.1372,
    address: "Zeitzer Stra√üe 1, 06712 Zeitz",
    phone: "+49 3441 12345",
    hours: "Mo-Fr: 08:00-18:00 Uhr"
  }
];
---

<div id="interactive-map" class="w-full rounded-xl overflow-hidden shadow-lg" style="height: 600px;"></div>

<script define:vars={{ locations }}>
  // Google Maps mit Manus Proxy laden
  const MANUS_PROXY_URL = 'https://maps-proxy.manus.im';
  
  function loadGoogleMaps() {
    return new Promise((resolve, reject) => {
      if (window.google && window.google.maps) {
        resolve(window.google.maps);
        return;
      }

      const script = document.createElement('script');
      script.src = `${MANUS_PROXY_URL}/maps/api/js?libraries=places,geometry&callback=initMap`;
      script.async = true;
      script.defer = true;
      
      window.initMap = () => {
        resolve(window.google.maps);
      };
      
      script.onerror = () => reject(new Error('Google Maps konnte nicht geladen werden'));
      document.head.appendChild(script);
    });
  }

  async function initializeMap() {
    try {
      const maps = await loadGoogleMaps();
      
      // Karte initialisieren (zentriert auf Leipzig)
      const map = new maps.Map(document.getElementById('interactive-map'), {
        center: { lat: 51.3397, lng: 12.3731 },
        zoom: 8,
        mapTypeControl: true,
        streetViewControl: true,
        fullscreenControl: true,
        zoomControl: true,
        styles: [
          {
            featureType: "poi",
            elementType: "labels",
            stylers: [{ visibility: "off" }]
          }
        ]
      });

      // InfoWindow (wird wiederverwendet)
      const infoWindow = new maps.InfoWindow();

      // Marker f√ºr jeden Standort erstellen
      locations.forEach((location) => {
        const marker = new maps.Marker({
          position: { lat: location.lat, lng: location.lng },
          map: map,
          title: location.name,
          icon: {
            path: maps.SymbolPath.CIRCLE,
            fillColor: '#00BCD4', // SENEC T√ºrkis
            fillOpacity: 1,
            strokeColor: '#FFFFFF',
            strokeWeight: 3,
            scale: 10
          },
          animation: maps.Animation.DROP
        });

        // InfoWindow-Inhalt
        const contentString = `
          <div style="padding: 12px; max-width: 280px; font-family: system-ui, -apple-system, sans-serif;">
            <h3 style="margin: 0 0 12px 0; font-size: 18px; font-weight: bold; color: #0D1B3E;">
              ${location.name}
            </h3>
            <div style="margin-bottom: 8px; color: #4B5563; line-height: 1.5;">
              <strong>üìç Adresse:</strong><br>
              ${location.address}
            </div>
            <div style="margin-bottom: 8px; color: #4B5563; line-height: 1.5;">
              <strong>üìû Telefon:</strong><br>
              <a href="tel:${location.phone}" style="color: #00BCD4; text-decoration: none;">
                ${location.phone}
              </a>
            </div>
            <div style="margin-bottom: 12px; color: #4B5563; line-height: 1.5;">
              <strong>üïí √ñffnungszeiten:</strong><br>
              ${location.hours}
            </div>
            <a 
              href="https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(location.address)}" 
              target="_blank"
              rel="noopener noreferrer"
              style="display: inline-block; padding: 8px 16px; background-color: #00BCD4; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; margin-top: 8px; transition: background-color 0.2s;"
              onmouseover="this.style.backgroundColor='#00ACC1'"
              onmouseout="this.style.backgroundColor='#00BCD4'"
            >
              Route planen ‚Üí
            </a>
          </div>
        `;

        // Klick-Event f√ºr Marker
        marker.addListener('click', () => {
          infoWindow.setContent(contentString);
          infoWindow.open(map, marker);
        });

        // Hover-Effekt (Bounce-Animation)
        marker.addListener('mouseover', () => {
          marker.setAnimation(maps.Animation.BOUNCE);
          setTimeout(() => marker.setAnimation(null), 750);
        });
      });

      console.log('‚úÖ Google Maps erfolgreich geladen mit', locations.length, 'Standorten');
    } catch (error) {
      console.error('‚ùå Fehler beim Laden von Google Maps:', error);
      document.getElementById('interactive-map').innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; background-color: #f3f4f6; color: #6b7280; font-family: system-ui;">
          <div style="text-align: center; padding: 2rem;">
            <p style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">Karte konnte nicht geladen werden</p>
            <p style="font-size: 0.875rem;">Bitte laden Sie die Seite neu oder kontaktieren Sie uns direkt.</p>
          </div>
        </div>
      `;
    }
  }

  // Karte initialisieren wenn DOM bereit ist
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeMap);
  } else {
    initializeMap();
  }
</script>
